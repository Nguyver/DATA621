---
title: "Critical Thinking Group 4 - HW4 - Auto Insurance"
author: "Sreejaya, Suman, Vuthy"
date: "November 7, 2016"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(warning=FALSE, message=FALSE, echo=FALSE)
knitr::opts_chunk$set(tidy.opts=list(width.cutoff=80),tidy=TRUE)
```


```{r, load libraries}
 library(dplyr)
# library(ggplot2)
# library(gridExtra)
# library(e1071)
# library(car)
# library(recommenderlab)
 library(knitr)
 library(Amelia)
# library(PerformanceAnalytics)
# library(robustbase)
# library(BMA)
# library(caret)
# library(pROC)
```

## Overview
The purpose of this project is to predict the probability that a person will crash their car and the amount of money it will cost if the person does crash their car using multiple linear regression and binary logistic regression models.  

**Dataset**  
[Insurance - Training data](https://raw.githubusercontent.com/Nguyver/DATA621-HW/master/HW4/insurance_training_data.csv)  
[Insurance - Evaluation Data](https://raw.githubusercontent.com/Nguyver/DATA621-HW/master/HW4/insurance-evaluation-data.csv)  

Below is a short description of the variables in the dataset.  

```{r}
desc <- 'data_desc.csv'

data_desc <- read.csv(desc)
kable(data_desc[,1:2])
```

## Data Exploration

```{r read data}
insurance.trn  <- read.csv("https://raw.githubusercontent.com/Nguyver/DATA621-HW/master/HW4/insurance_training_data.csv", header=TRUE, sep=",", stringsAsFactors = FALSE)

insurance.evl  <- read.csv("https://raw.githubusercontent.com/Nguyver/DATA621-HW/master/HW4/insurance-evaluation-data.csv", header=TRUE, sep=",", stringsAsFactors = FALSE)
```
The dataset contains roughly 8000 observations and 26 variables. Each record has two response variables. 

- TARGET_FLAG
- TARGET_AMT 

Running the glimpse() function on the dataset reveals a few issues with the data.  

Some data points have to be cleaned up

- INCOME
- HOME_VAL
- MSTATUS
- SEX
- EDUCATION
- JOB
- BLUEBOOK
- CAR_TYPE
- OLDCLAIM

A few variables need to be converted to factors

- TARGET_FLAG
- PARENT1
- MSTATUS
- SEX
- EDUCATION
- JOB
- CAR_USE
- CAR_TYPE
- RED_CAR
- REVOKED
- URBANICITY

A few variables need to be converted to integers

- INCOME
- HOME_VAL
- BLUEBOOK
- OLDCLAIM

```{r eval=FALSE}
glimpse(insurance.trn)
```
As with the glimpse() function, the summary() function reveals a few variables need to be coerced as well as a few missing values (NA).  
```{r eval=FALSE}
summary(insurance.trn)
```

```{r eval=FALSE}
### Visually assessing missing values: 
The Amelia package has a plotting function missmap() that will plot the dataset and highlight missing values:

missmap(insurance.trn, main = "Missing values vs observed")
```
The following variables have missing values:  

| Variable Name | # NA |
|---------------|------|
| AGE           | 6    |
| CAR_AGE       | 510  |
| YOJ           | 454  |


## Data Preparation

### Remove unnecessory variables:
"INDEX" is nothing more than an arbitrary identifier that provides no predictive value. It will be removed from the data set.  
```{r echo=TRUE}
insurance.trn$INDEX <- NULL
```

### Clean up data
Dollar signs and commas need to be removed from **INCOME, HOME_VAL, BLUEBOOK, OLDCLAIM**

```{r echo=TRUE}
pattern1 <- '\\$*|,'
replacement <- ''

insurance.trn$INCOME <- as.integer(gsub(pattern1,replacement, x=insurance.trn$INCOME))
insurance.trn$HOME_VAL <- as.integer(gsub(pattern1,replacement, x=insurance.trn$HOME_VAL))
insurance.trn$BLUEBOOK <- as.integer(gsub(pattern1,replacement, x=insurance.trn$BLUEBOOK))
insurance.trn$OLDCLAIM <- as.integer(gsub(pattern1,replacement, x=insurance.trn$OLDCLAIM))
```
'z_' will be removed from **MSTATUS, SEX, EDUCATION, JOB, CAR_TYPE**

```{r echo=TRUE}
pattern1 <- 'z_'
replacement <- ''

insurance.trn$MSTATUS <- gsub(pattern1,replacement, x=insurance.trn$MSTATUS)
insurance.trn$SEX <- gsub(pattern1,replacement, x=insurance.trn$SEX)
insurance.trn$EDUCATION <- gsub(pattern1,replacement, x=insurance.trn$EDUCATION)
insurance.trn$JOB <- gsub(pattern1,replacement, x=insurance.trn$JOB)
insurance.trn$CAR_TYPE <- gsub(pattern1,replacement, x=insurance.trn$CAR_TYPE)
```

### Factorize Variables:

Convert the **TARGET_FLAG, PARENT1, SEX, MSTATUS, EDUCATION, JOB, CAR_USE, CAR_TYPE, RED_CAR, REVOKED, URBANICITY** variables into factors:

```{r echo=TRUE}
insurance.trn$TARGET_FLAG <- as.factor(insurance.trn$TARGET_FLAG)
insurance.trn$PARENT1 <- as.factor(insurance.trn$PARENT1)
insurance.trn$SEX <- as.factor(insurance.trn$SEX)
insurance.trn$MSTATUS <- as.factor(insurance.trn$MSTATUS)
insurance.trn$EDUCATION <- as.factor(insurance.trn$EDUCATION)
insurance.trn$JOB <- as.factor(insurance.trn$JOB)
insurance.trn$CAR_USE <- as.factor(insurance.trn$CAR_USE)
insurance.trn$CAR_TYPE <- as.factor(insurance.trn$CAR_TYPE)
insurance.trn$RED_CAR <- as.factor(insurance.trn$RED_CAR)
insurance.trn$REVOKED <- as.factor(insurance.trn$REVOKED)
insurance.trn$URBANICITY <- as.factor(insurance.trn$URBANICITY)
```

### Handling missing data
1. There are 510 NA's in CAR_AGE, so it is not a good idea to throw these records away.
```{r}
hist( insurance.trn$CAR_AGE)
```
From the histogram, we see that CAR_AGE between 5 and 15 are the most common, But there is one record with negative value, which should be replaced. 
so filling in NA's/negative value  with  mean(8) or median(8.33) would be entirely reasonable. Let's fill in the NA's/negative value with the mean value of 8:

```{r}
meanVal <- 8

insurance.trn$CAR_AGE<- ifelse( insurance.trn$CAR_AGE <=0 , meanVal, insurance.trn$CAR_AGE)
insurance.trn$CAR_AGE<- ifelse(is.na( insurance.trn$CAR_AGE )==TRUE, meanVal, insurance.trn$CAR_AGE)

summary(insurance.trn$CAR_AGE)
```
2. There are 454 NA's in YOJ, so it is not a good idea to throw these records away.  
```{r}
hist( insurance.trn$YOJ)
```
From the histogram, we see that YOJ between 8 and 12 are the most common, 
so filling in NA's  with  mean(10.5) or median(11) would be entirely reasonable.
Let's fill in the NA's with the median 11:
```{r}
medianVal <- 11

insurance.trn$YOJ<- ifelse(is.na( insurance.trn$YOJ )==TRUE, medianVal, insurance.trn$YOJ)

summary(insurance.trn$YOJ)
```

Let us consider outliars for AGE before removing NA's

```{r}
boxplot( insurance.trn$AGE )
hist( insurance.trn$AGE)
```
Since the mean, and median are approximately equal to each other, data is approximately symmetrical and there are no outliars. Mean=44.79 and Median =45. So let's fill in the NA's with the median 45:
```{r}
medianVal <- 45

insurance.trn$AGE<- ifelse(is.na( insurance.trn$AGE )==TRUE, medianVal, insurance.trn$AGE)

summary(insurance.trn$AGE)
```

