---
title: "CT4 - HW1"
author: "Sreejaya, Suman, Vuthy"
date: "September 12, 2016"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

##Critical Thinking Group 4 - HW1

Let me know what you guys think. We can use this file to do the coding and document details for each other. At the end, when we are done, we put together a much cleaner document without all the details and code we left for each other.  


```{r}
## load libraries ####

library(RCurl)
library(dplyr)
library(ggplot2)
library(gridExtra)
library(psych)
```

Read in the file to do Exploratory Data Analysis

```{r}
#read directly from the github
moneyballTraining <- read.csv("https://raw.githubusercontent.com/Nguyver/DATA621-HW/master/HW1/moneyball-training-data.csv", header=TRUE, sep=",", stringsAsFactors = FALSE)

head(moneyballTraining)
names(moneyballTraining)
summary(moneyballTraining)

#Cleaning ?


#Data Exploration:

# 'TARGET_WINS' is the Dependent/Response variable here. And below are the independent (/exploratory) variables.
# Indpendent Variables: TEAM_BATTING_H TEAM_BATTING_2B TEAM_BATTING_3B  TEAM_BATTING_HR  TEAM_BATTING_BB TEAM_BATTING_SO  TEAM_BASERUN_SB TEAM_BASERUN_CS

# Let us try to explore each of the exploratory variable's distribution [histogram, boxplot - to understand the distribution and identify outliers etc.]
# Let us also explore how each of the independent variable related to the response variable ( using scatter plot )
# what else ?

#
library(ggplot2)

# Explore independent variable TEAM_BATTING_H
ggplot(data = moneyballTraining) + geom_histogram(aes(x=TEAM_BATTING_H), binwidth = 0.5) + ggtitle(paste("Histogram  - " , "TEAM_BATTING_H")) 

qplot(y=moneyballTraining$TEAM_BATTING_H, x= 1, geom = "boxplot")

ggplot(data = moneyballTraining) + geom_point(aes(x=TEAM_BATTING_H, y= TARGET_WINS), alpha = 0.2, color="blue") + ggtitle("TARGET WINS  Vs TEAM_BATTING_H") 

```


sreejaya
```{r}
##Load Data

moneyballtrain.URL <- getURL("https://raw.githubusercontent.com/Nguyver/DATA621-HW/master/HW1/moneyball-training-data.csv")
moneyballTraining <- read.csv(text = moneyballtrain.URL,header = TRUE, stringsAsFactors = FALSE)
names(moneyballTraining)



```

Summary to review data distribution, NA's. Impute of missing values and view Standard Deviation before and after imputation.
```{r}

summary(moneyballTraining[3:17])

dev.off()

#Visualize the Standard deviations in all the independent variables -Suman.
#--------------------------------------------------------------------------
getStandardDev <- function(moneyballTraining)
{
  stdDevs <- SD(moneyballTraining[3:17])
  stdDevs[order(stdDevs, decreasing = T)]
  
  par(mai=c(3,1.2,1,1))
  
  # transformed the y, due to high variances.
  barplot(stdDevs[order(stdDevs, decreasing = T)], log = "y", las=2, main="Std Dev of Predictors", xlab="", ylab="Log(SD)", cex.axis = 0.8, cex.names=0.8)
  +mtext("Predictors", side=1, line = 8.5, las=1)
  return(stdDev)
}


getStandardDev(moneyballTraining)
#--------------------------------------------------------------------------

#Replacing Missing Values In dataset with column mean
for(i in 1:ncol(moneyballTraining)){
  moneyballTraining[is.na(moneyballTraining[,i]), i] <- mean(moneyballTraining[,i], na.rm = TRUE)
}

#After imputation , verify the standard deviation again.
getStandardDev(moneyballTraining)
```

Finding Outliers using boxplot
```{r}
#Box plot to find outliers
par(mfrow=c(3,5))
boxplot(moneyballTraining$TEAM_BATTING_H, main="TEAM_BATTING_H")
boxplot(moneyballTraining$TEAM_BATTING_2B, main="TEAM_BATTING_2B")
boxplot(moneyballTraining$TEAM_BATTING_3B, main="TEAM_BATTING_3B")
boxplot(moneyballTraining$TEAM_BATTING_HR, main="TEAM_BATTING_HR")
boxplot(moneyballTraining$TEAM_BATTING_BB, main="TEAM_BATTING_BB")

boxplot(moneyballTraining$TEAM_BATTING_SO, main="TEAM_BATTING_SO")
boxplot(moneyballTraining$TEAM_BASERUN_SB, main="TEAM_BASERUN_SB")
boxplot(moneyballTraining$TEAM_BASERUN_CS, main="TEAM_BASERUN_CS")
boxplot(moneyballTraining$TEAM_BATTING_HBP, main="TEAM_BATTING_HBP")
boxplot(moneyballTraining$TEAM_PITCHING_H, main="TEAM_PITCHING_H")

boxplot(moneyballTraining$TEAM_PITCHING_HR, main="TEAM_PITCHING_HR")
boxplot(moneyballTraining$TEAM_PITCHING_BB, main="TEAM_PITCHING_BB")
boxplot(moneyballTraining$TEAM_PITCHING_SO, main="TEAM_PITCHING_SO")
boxplot(moneyballTraining$TEAM_FIELDING_E, main="TEAM_FIELDING_E")
boxplot(moneyballTraining$TEAM_FIELDING_DP, main="TEAM_FIELDING_DP")

par(mfrow=c(3, 5))
for (response in c("TEAM_BATTING_H" ,  "TEAM_BATTING_2B",  "TEAM_BATTING_3B" ,
  "TEAM_BATTING_HR" , "TEAM_BATTING_BB",  "TEAM_BATTING_SO",  "TEAM_BASERUN_SB" , "TEAM_BASERUN_CS", 
 "TEAM_BATTING_HBP","TEAM_PITCHING_H",  "TEAM_PITCHING_HR", "TEAM_PITCHING_BB", "TEAM_PITCHING_SO",
"TEAM_FIELDING_E" , "TEAM_FIELDING_DP"))
+ boxplot(moneyballTraining[, response] ~ TARGET_WINS, data=moneyballTraining, ylab=response)
dev.off()
```


Removing Outliers
```{r}
#
# comparing median to mean. Usually median and mean should be the same. But if median is far lower than the mean it could suggest that there are outliers.

#from the BoxPlot we see otliers for 

#TEAM_BATTING_3B, TEAM_BASERUN_SB,TEAM_BASERUN_CS, TEAM_PITCHING_H, TEAM_PITCHING_BB, TEAM_PITCHING_#SO, TEAM_FIELDING_E
# since TEAM_BASERUN_CS and TEAM_PITCHING_SO have same mean and median we can assume that they dont have ant outliers.

##?? do we need to remove zero's? Max values seems reasonable or not??
```

find correlation of Response variable with predictor variables
```{r}

corData <-  round(cor(moneyballTraining), 3)                    # rounding makes it easier to look at
library(reshape)
t(corData[2,c(2:17)])   # we are only interested on correlation of Team win against all other predictors
moneyballTraining.cor <- melt(t(corData[2,c(2:17)])) # convert the wide format to long form for ease of read
moneyballTraining.cor

## TEAM_BATTING_SO,TEAM_PITCHING_H,  TEAM_FIELDING_E  have negative correlation with total win. (which is expected)

#TEAM_PITCHING_SO,TEAM_FIELDING_DP (but this should be positive)

## TEAM_BASERUN_CS, TEAM_BATTING_HBP have very low correlation with Total win. So we dont have to consider these variables in the MODEL


```

Predictor Variables  Vs Response variable(Target win) 
Correlation Visualization
```{r}
 
#plt_TEAM_BATTING_H<-ggplot(data = moneyballTraining,aes(x=TEAM_BATTING_H,y=TARGET_WINS)) + geom_point() + #geom_smooth(method=glm)  + ggtitle(paste("Plot  - " , "TEAM_BATTING_H")) 

plt_TEAM_BATTING_H <- ggplot(moneyballTraining, aes(TEAM_BATTING_H,TARGET_WINS))
plt_TEAM_BATTING_H <-plt_TEAM_BATTING_H + stat_smooth(method='gam') + geom_point()+ ggtitle(paste("Plot  - " , "TEAM_BATTING_H"))

plt_TEAM_BATTING_2B <- ggplot(moneyballTraining, aes(TEAM_BATTING_2B,TARGET_WINS))
plt_TEAM_BATTING_2B <-plt_TEAM_BATTING_2B + stat_smooth(method='gam') + geom_point()+ ggtitle(paste("Plot  - " , "TEAM_BATTING_2B"))

plt_TEAM_BATTING_3B <- ggplot(moneyballTraining, aes(TEAM_BATTING_3B,TARGET_WINS))
plt_TEAM_BATTING_3B <-plt_TEAM_BATTING_3B + stat_smooth(method='gam') + geom_point()+ ggtitle(paste("Plot  - " , "TEAM_BATTING_3B"))

plt_TEAM_BATTING_HR <- ggplot(moneyballTraining, aes(TEAM_BATTING_HR,TARGET_WINS))
plt_TEAM_BATTING_HR <-plt_TEAM_BATTING_HR + stat_smooth(method='gam') + geom_point()+ ggtitle(paste("Plot  - " , "TEAM_BATTING_HR"))

plt_TEAM_BATTING_BB <- ggplot(moneyballTraining, aes(TEAM_BATTING_BB,TARGET_WINS))
plt_TEAM_BATTING_BB <-plt_TEAM_BATTING_BB + stat_smooth(method='gam') + geom_point()+ ggtitle(paste("Plot  - " , "TEAM_BATTING_BB"))

plt_TEAM_BATTING_SO <- ggplot(moneyballTraining, aes(TEAM_BATTING_SO,TARGET_WINS))
plt_TEAM_BATTING_SO <-plt_TEAM_BATTING_SO + stat_smooth(method='gam') + geom_point()+ ggtitle(paste("Plot  - " , "TEAM_BATTING_SO"))

plt_TEAM_BASERUN_SB <- ggplot(moneyballTraining, aes(TEAM_BASERUN_SB,TARGET_WINS))
plt_TEAM_BASERUN_SB <-plt_TEAM_BASERUN_SB + stat_smooth(method='gam') + geom_point()+ ggtitle(paste("Plot  - " , "TEAM_BASERUN_SB"))


plt_TEAM_BASERUN_CS <- ggplot(moneyballTraining, aes(TEAM_BASERUN_CS,TARGET_WINS))
plt_TEAM_BASERUN_CS <-plt_TEAM_BASERUN_CS + stat_smooth(method='gam') + geom_point()+ ggtitle(paste("Plot  - " , "TEAM_BASERUN_CS"))

plt_TEAM_BATTING_HBP <- ggplot(moneyballTraining, aes(TEAM_BATTING_HBP,TARGET_WINS))
plt_TEAM_BATTING_HBP <-plt_TEAM_BATTING_HBP + stat_smooth(method='gam') + geom_point()+ ggtitle(paste("Plot  - " , "TEAM_BATTING_HBP"))

plt_TEAM_PITCHING_H <- ggplot(moneyballTraining, aes(TEAM_PITCHING_H,TARGET_WINS))
plt_TEAM_PITCHING_H <-plt_TEAM_PITCHING_H + stat_smooth(method='gam') + geom_point()+ ggtitle(paste("Plot  - " , "TEAM_PITCHING_H"))

plt_TEAM_PITCHING_HR <- ggplot(moneyballTraining, aes(TEAM_PITCHING_HR,TARGET_WINS))
plt_TEAM_PITCHING_HR <-plt_TEAM_PITCHING_HR + stat_smooth(method='gam') + geom_point()+ ggtitle(paste("Plot  - " , "TEAM_PITCHING_HR"))

plt_TEAM_PITCHING_BB <- ggplot(moneyballTraining, aes(TEAM_PITCHING_BB,TARGET_WINS))
plt_TEAM_PITCHING_BB <-plt_TEAM_PITCHING_BB + stat_smooth(method='gam') + geom_point()+ ggtitle(paste("Plot  - " , "TEAM_PITCHING_BB"))

plt_TEAM_PITCHING_SO <- ggplot(moneyballTraining, aes(TEAM_PITCHING_SO,TARGET_WINS))
plt_TEAM_PITCHING_SO <-plt_TEAM_PITCHING_SO + stat_smooth(method='gam') + geom_point()+ ggtitle(paste("Plot  - " , "TEAM_PITCHING_SO"))

plt_TEAM_FIELDING_E <- ggplot(moneyballTraining, aes(TEAM_FIELDING_E,TARGET_WINS))
plt_TEAM_FIELDING_E <-plt_TEAM_FIELDING_E + stat_smooth(method='gam') + geom_point()+ ggtitle(paste("Plot  - " , "TEAM_FIELDING_E"))

plt_TEAM_FIELDING_DP <- ggplot(moneyballTraining, aes(TEAM_FIELDING_DP,TARGET_WINS))
plt_TEAM_FIELDING_DP <-plt_TEAM_FIELDING_DP + stat_smooth(method='gam') + geom_point()+ ggtitle(paste("Plot  - " , "TEAM_FIELDING_DP"))

#All Predictor Variables
grid.arrange(plt_TEAM_BATTING_H, plt_TEAM_BATTING_2B, plt_TEAM_BATTING_3B, plt_TEAM_BATTING_HR, plt_TEAM_BATTING_BB,plt_TEAM_BATTING_SO, plt_TEAM_BASERUN_SB, plt_TEAM_BASERUN_CS, plt_TEAM_BATTING_HBP, plt_TEAM_PITCHING_H, plt_TEAM_PITCHING_HR, plt_TEAM_PITCHING_SO, plt_TEAM_FIELDING_E, plt_TEAM_FIELDING_DP, plt_TEAM_PITCHING_BB,    ncol = 3, nrow = 5)

#positive impact on wins

grid.arrange(plt_TEAM_BATTING_H, plt_TEAM_BATTING_2B, plt_TEAM_BATTING_3B, plt_TEAM_BATTING_HR, plt_TEAM_BATTING_BB, plt_TEAM_BASERUN_SB,  plt_TEAM_BATTING_HBP,   plt_TEAM_PITCHING_SO,  plt_TEAM_FIELDING_DP,   ncol = 3, nrow = 5)

#negative impact on wins
grid.arrange(plt_TEAM_BATTING_SO,  plt_TEAM_BASERUN_CS,  plt_TEAM_PITCHING_H, plt_TEAM_PITCHING_HR,  plt_TEAM_FIELDING_E,  plt_TEAM_PITCHING_BB,    ncol = 3, nrow = 5)



```


## 3.Build  Models
To fit a multiple linear regression model with TARGET_WINS as the response variable all the other predictors as the explanatory variables except 'TEAM BASERUN CS' &  'TEAM BATTING HBP' as they have very low correlation with Wins:
We eliminate TEAM_BASERUN_CS

# 3.1 Manual elimination
```{r}
#Full Model

team.mod1 <- lm(formula = TARGET_WINS~TEAM_BATTING_H +  TEAM_BATTING_2B+  TEAM_BATTING_3B +
 TEAM_BATTING_HR + TEAM_BATTING_BB +  TEAM_BATTING_SO +  TEAM_BASERUN_SB + TEAM_BASERUN_CS + TEAM_BATTING_HBP +
TEAM_PITCHING_H +  TEAM_PITCHING_HR + TEAM_PITCHING_BB + TEAM_PITCHING_SO +
TEAM_FIELDING_E + TEAM_FIELDING_DP,data =moneyballTraining)
summary(team.mod1)

 #R-squared:  0.3192,  Adjusted R-squared:  0.3147
team.mod2 <- lm(formula = TARGET_WINS~TEAM_BATTING_H +  TEAM_BATTING_2B+  TEAM_BATTING_3B +
 TEAM_BATTING_HR + TEAM_BATTING_BB +  TEAM_BATTING_SO +  TEAM_BASERUN_SB + 
TEAM_PITCHING_H +  TEAM_PITCHING_HR + TEAM_PITCHING_BB + TEAM_PITCHING_SO +
TEAM_FIELDING_E + TEAM_FIELDING_DP,data =moneyballTraining)

summary(team.mod2)
#R-squared:  0.3188,  Adjusted R-squared:  0.3149  
#Adjusted R-squared is higher than the original one.  


```

#3.2 Stepwise Regression
```{r}
library(MASS)
fit <- lm(formula = TARGET_WINS~TEAM_BATTING_H +  TEAM_BATTING_2B+  TEAM_BATTING_3B +
 TEAM_BATTING_HR + TEAM_BATTING_BB +  TEAM_BATTING_SO +  TEAM_BASERUN_SB + TEAM_BASERUN_CS + TEAM_BATTING_HBP + 
TEAM_PITCHING_H +  TEAM_PITCHING_HR + TEAM_PITCHING_BB + TEAM_PITCHING_SO +
TEAM_FIELDING_E + TEAM_FIELDING_DP,data =moneyballTraining)

# Stepwise Regression
step <- stepAIC(fit, direction="both")
step$anova # display results
summary(step)
#R-squared:  0.3186,  Adjusted R-squared:  0.3153 

par(mfrow=c(2, 2))
plot(step,, main="Stepwise Regression")
```
#Model with Stepwise Regression
TARGET_WINS = 23.67 + 0.048*TEAM_BATTING_H + -0.020*TEAM_BATTING_2B + 0.0625*TEAM_BATTING_3B + 
    0.0698*TEAM_BATTING_HR + 0.011*TEAM_BATTING_BB + -0.009*TEAM_BATTING_SO + 0.029*TEAM_BASERUN_SB + 
    -0.0007*TEAM_PITCHING_H + 0.0029*TEAM_PITCHING_SO + -0.0206*TEAM_FIELDING_E + -0.121*TEAM_FIELDING_DP
    
#3.3 Backward elimination model   
```{r}
step.backward <- step(fit, direction="backward")
step$anova # display results
summary(step.backward)

#R-squared:  0.3186,  Adjusted R-squared:  0.3153
par(mfrow=c(2, 2))
plot(step.backward, main="Backward elimination")
```
#Model with Backward elimination
TARGET_WINS = 23.66 + 0.048*TEAM_BATTING_H + -0.020*TEAM_BATTING_2B + 
    0.062*TEAM_BATTING_3B + 0.0698*TEAM_BATTING_HR + 0.011*TEAM_BATTING_BB + -0.009*TEAM_BATTING_SO + 
    0.029*TEAM_BASERUN_SB + -0.001*TEAM_PITCHING_H + 0.002*TEAM_PITCHING_SO + -0.021*TEAM_FIELDING_E + 
    -0.121*TEAM_FIELDING_DP

#3.4 forward Elimination
```{r}
forward.null <-lm(TARGET_WINS~1,data=moneyballTraining)
forward.full <-lm(TARGET_WINS~.,data=moneyballTraining)
step.forward<- step(forward.null, scope=list(lower=forward.null, upper=forward.full), direction="forward")

summary(step.forward)
# R-squared:  0.3188,  Adjusted R-squared:  0.3152
par(mfrow=c(2, 2))
plot(step.forward, main="Forward Elimination")
```
#Model with forward elimination
TARGET_WINS = 24.23 + 0.048*TEAM_BATTING_H + -0.021*TEAM_FIELDING_E + 
    0.029*TEAM_BASERUN_SB + -0.12*TEAM_FIELDING_DP + 0.015*TEAM_PITCHING_HR + 0.061*TEAM_BATTING_3B + 
    0.011*TEAM_BATTING_BB + -0.009*TEAM_BATTING_SO + 0.003*TEAM_PITCHING_SO + -0.0007*TEAM_PITCHING_H + 
    0.054*TEAM_BATTING_HR + -0.02*TEAM_BATTING_2B


##Backward elimination and Stepwise Regression Model has the best Adjusted R-squared value.
#So we would like select Backward elimination model  

